name: "Check CI Status"
description: "Verifies that CI checks have passed before proceeding"

runs:
  using: composite
  steps:
    - name: Verify CI Passed
      uses: actions/github-script@v7
      with:
        script: |
          const { data: checks } = await github.rest.checks.listForRef({
            owner: context.repo.owner,
            repo: context.repo.repo,
            ref: context.payload.pull_request.head.sha
          });

          const ciCheck = checks.check_runs.find(check => check.name === 'CI Checks');

          if (!ciCheck) {
            core.setFailed('❌ CI Checks not found. Please wait for CI to run first.');
            return;
          }

          if (ciCheck.conclusion !== 'success') {
            core.setFailed(`❌ CI Checks must pass before proceeding. Current status: ${ciCheck.conclusion || ciCheck.status}`);
            return;
          }

          core.info('✅ CI Checks passed');
